# Euler Problem #2

## Problem Statement

[Euler Problem #2][Project Euler] asks:

> Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with and , the first terms will be:
> \\[1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, \dots \\]
> By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.

## Simple solution

First let's define an implementation of the Fibonacci sequence:

```lean
{{#include ../Commonplace/Fibonacci.lean:fibs_def}}
```

A very simple solution is to filter the even element of this list, and sum them
like so:

```lean
{{#include ../EulerProblems/Problem2.lean:fibs_filter}}
```

## Removing `filter`

By observing the fibs sequence, we can see that every even number is every third element.

\\[1, 1, \underline{2}, 3, 5, \underline{8}, 13, 21, \underline{34}, 55, 89, \underline{144}, \dots \\]

We can prove this by showing that every `nth` Fibonacci number is even if, and only if, n is a multiple of 3, plus 2.

```lean
{{#include ../Commonplace/Fibonacci.lean:proof_fibs_even}}
```

So with minimal modification we can define a new sequence, `FibsEven`, 
which should produce every even Fibonacci number

```lean
{{#include ../Commonplace/Fibonacci.lean:fibs_even_def}}
```

And indeed, a cursory evaluation of the outputs is promising for the first couple of terms:

```lean
{{#include ../EulerProblems/Problem2.lean:fibs_even_example}}
```

We can in-fact prove that for every `nth` index in `FibsEven`, 
this matches a multiple of 3 (+ 2) in `Fibs`, which proves that our sequence represents all
even members of `Fibs`.

```lean
{{#include ../Commonplace/Fibonacci.lean:as_fibs_proof}}

{{#include ../Commonplace/Fibonacci.lean:as_fibs_proof_impl}}
```


We must now show that `fibs_even'` is equivalent to `FibsEven`.

We can first do this by removing the tricky `filter`. This is done by making a more easy to 
manipulate `map` function across the indices which give even members.

```lean
{{#include ../EulerProblems/Problem2.lean:even_fibs_eq_map_proof}}
```

Which is the stepping stone which lets us show that `even_fibs'` and `FibsEven` are equivalent:

```lean
{{#include ../EulerProblems/Problem2.lean:even_fibs_eq_fibseven}}
```

## Removing Sum

What of the sum function? For this, let's examine our sequence of even Fibonacci sums:

```lean
{{#include ../EulerProblems/Problem2.lean:even_sum_sequence_eval}}
```

The sequence is:

\\[2, 10, 44, 188, 798, 3382, 14328, \dots \\]

Which looks like it may be a Fibonacci sequence with some manipulation. But we don't need 
to figure it out ourselves, the [Online Encyclopedia of Integer Sequences][OEIS] knows what this sequence is, which gives some hints on its relationship to other sequences. 

By playing around with some definitions, we can eventually reach this manipulation:

```lean
{{#include ../EulerProblems/Problem2.lean:even_sum_sequence_eval_2}}
```

So let's prove that it is equivalent:

```lean
{{#include ../Commonplace/Fibonacci.lean:fibseven_sum_eq_proof}}
```

Which finally let's us show that `fibs_even'.sum` can be written without `filter` or `sum`:

```lean
{{#include ../EulerProblems/Problem2.lean:even_fib_sum_eq_fibs_nth}}
```

[Project Euler]: https://projecteuler.net/problem=2 "Project Euler"
[OEIS]: https://oeis.org/A099919 "OEIS Sequence A099919"